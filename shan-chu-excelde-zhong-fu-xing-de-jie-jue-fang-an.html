<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>删除Excel的重复行的解决方案 | Zongjian’s blog</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="删除Excel的重复行的解决方案" />
<meta name="author" content="omale" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="今天有个在工商银行工作的哥们，打电话告诉我，他有一个Excel文件，有一些行重复了，需要把那些重复的行删除掉。虽然我不是很喜欢干OA的活，但是哥们的忙还是要帮的，接！ 发给我的是一个csv文件，里面有45000多条记录，大概的样子是这样:" />
<meta property="og:description" content="今天有个在工商银行工作的哥们，打电话告诉我，他有一个Excel文件，有一些行重复了，需要把那些重复的行删除掉。虽然我不是很喜欢干OA的活，但是哥们的忙还是要帮的，接！ 发给我的是一个csv文件，里面有45000多条记录，大概的样子是这样:" />
<link rel="canonical" href="https://www.hezongjian.com/shan-chu-excelde-zhong-fu-xing-de-jie-jue-fang-an.html" />
<meta property="og:url" content="https://www.hezongjian.com/shan-chu-excelde-zhong-fu-xing-de-jie-jue-fang-an.html" />
<meta property="og:site_name" content="Zongjian’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2005-05-10T20:00:00-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="删除Excel的重复行的解决方案" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"omale"},"dateModified":"2005-05-10T20:00:00-04:00","datePublished":"2005-05-10T20:00:00-04:00","description":"今天有个在工商银行工作的哥们，打电话告诉我，他有一个Excel文件，有一些行重复了，需要把那些重复的行删除掉。虽然我不是很喜欢干OA的活，但是哥们的忙还是要帮的，接！ 发给我的是一个csv文件，里面有45000多条记录，大概的样子是这样:","headline":"删除Excel的重复行的解决方案","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.hezongjian.com/shan-chu-excelde-zhong-fu-xing-de-jie-jue-fang-an.html"},"url":"https://www.hezongjian.com/shan-chu-excelde-zhong-fu-xing-de-jie-jue-fang-an.html"}</script>
<!-- End Jekyll SEO tag -->
<link id="main-stylesheet" rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://www.hezongjian.com/feed.xml" title="Zongjian&apos;s blog" />
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Zongjian&#39;s blog</a>

    <nav class="site-nav">
      <a class="page-link" href="/">Home</a>
      <a class="page-link" href="/categories/">Categories</a>
      <a class="page-link" href="/tags/">Tags</a>
      <a class="page-link" href="/archive/">Archive</a>
    </nav>
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">删除Excel的重复行的解决方案</h1>
    <div class="post-meta">
      <time class="dt-published" datetime="2005-05-10T20:00:00-04:00" itemprop="datePublished">
        May 10, 2005
      </time></div>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>今天有个在工商银行工作的哥们，打电话告诉我，他有一个Excel文件，有一些行重复了，需要把那些重复的行删除掉。虽然我不是很喜欢干OA的活，但是哥们的忙还是要帮的，接！<br />
发给我的是一个csv文件，里面有45000多条记录，大概的样子是这样:</p>

<p>BILLNO BUNDLE ACCEPTBANK HOLDER BUYTYPE AMOUNT<br />
AA0100003443 2.00E+11 87647 87649 2 10000000<br />
AA0100003444 2.00E+11 87647 87649 2 10000000</p>

<p>有些记录的BILLNO重复了，重复的据说大概有几百条，所有BILLNO重复的记录只要留一条就可以了。其余的要删除掉。</p>

<p>看着这个记录这么整齐，我最先想到的就是关系型数据库（没办法，谁让J2EE,UML,VC,DB是我们的饭碗课程呢？），心里面已经开始默默念叨SQL语句了，“万幸”我的机器上还装了个Access 2003，虽然不咋地，也凑合着用吧。好，打开Acesss，把CSV倒入到Access中，感谢Access的强大功能，我非常顺利的得到了数据表a。下面，就容易了，我最先想到的是建立一个新表，然后把BILLNO设成Primpary Key，这样就可以保证唯一了。结果结果，后来我发现在Acess里面，这么做还真不简单：Access会自己建立一个Integer型的索引，不理我的索引，然后，插入据怎么插，失败了怎么办，都麻烦，所以就放弃了这个打算。后来想，用SQL语句直接把一个表的内容选择到另外一个标，不就OK了么，好，新建一个空白的数据表b，其结构与a完全一致。然后写SQL：</p>

<p>INSERT INTO b<br />
SELECT * FROM a<br />
WHERE a.BILLNO in<br />
(	<br />
SELECT max(a.BILLNO) FROM a GROUP BY a.BILLNO<br />
)</p>

<p>结果，执行的结果让我大跌眼镜，我P3 1G的本本，一运行这段代码，CPU立即100%，经过了5分钟都没有停的迹象。后来想也是，Access本来数据处理就不强，如果不加优化，这段SQL相当于一个两重循环，即使优化了，外层SQL也要在几万条数据里面找东西。的确效率不高，我使用数据库的尝试以失败告终。。。</p>

<p>后来，我想到了Office里面不是本来就可以用VBA写程序么，虽然功能不咋地，但是毕竟有阿，为啥要舍近求远呢？好，打开Visual Basic编辑器，鼠标在form上拖一个Button（寒假里面我已经教会我爹在form上拖button了），double click，开始coding。再次感谢Office的强大的帮助，很快我就找打了如何引用单元格的数据。首先，先把Excel按照BILLNO来排个序，然后用阔别N年的Visual Basic代码Coding道：</p>

<p>Private Sub CommandButton1_Click()</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Dim i  
  
For i = 2 To 47522  
    If Sheet1.Cells(i, 1).Value = Sheet1.Cells(i + 1, 1).Value Then  
        Sheet1.Cells(i, 1).Value = "AA"  
    End If  
Next i
</code></pre></div></div>

<p>End Sub</p>

<p>按F5，执行，果然，所有重复的行的BILLNO都被换成了”AA”，只保留了一行。哈哈，然后再对BILLNO拍个序，手动选择所有都是AA的行，删除，搞定！！</p>

<p>像所有程序员和妓女一样，工作的时候精神高度紧张，干完了，感受到了无与伦比的乐趣……乐趣完了，应该考虑一下这次有些什么经验教训：</p>

<p>首先，客户的要求真是无奇不有，但是，俺们要始终坚持一点：程序员的事“只要想不到，没有做不到”。</p>

<p>第二：惯性思维还挺害人的，对于人到中年(嘻嘻，指的是有一定经验)的程序员来说，更是会情不自禁的这样。</p>

<p>第三：虽然好久没Coding，偶还没老….</p>

<font class="diary_poster">
</font>

  </div>

  <a class="u-url" href="/shan-chu-excelde-zhong-fu-xing-de-jie-jue-fang-an.html" hidden></a>
</article>


      </div>
    </main><link id="fa-stylesheet" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.0/css/all.min.css">

<footer class="site-footer h-card">
  <data class="u-url" value="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <ul class="contact-list">
          <li class="p-name">Zongjian He</li>
          <li><a class="u-email" href="mailto:"></a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Personal blog of Zongjian He</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list">
  <li>
    <a href="https://www.hezongjian.com/feed.xml" target="_blank" title="Subscribe to syndication feed">
      <svg class="svg-icon grey" viewbox="0 0 16 16">
        <path d="M12.8 16C12.8 8.978 7.022 3.2 0 3.2V0c8.777 0 16 7.223 16 16h-3.2zM2.194
          11.61c1.21 0 2.195.985 2.195 2.196 0 1.21-.99 2.194-2.2 2.194C.98 16 0 15.017 0
          13.806c0-1.21.983-2.195 2.194-2.195zM10.606
          16h-3.11c0-4.113-3.383-7.497-7.496-7.497v-3.11c5.818 0 10.606 4.79 10.606 10.607z"
        />
      </svg>
    </a>
  </li>
</ul>
</div>

  </div>

</footer>

</body>

</html>
