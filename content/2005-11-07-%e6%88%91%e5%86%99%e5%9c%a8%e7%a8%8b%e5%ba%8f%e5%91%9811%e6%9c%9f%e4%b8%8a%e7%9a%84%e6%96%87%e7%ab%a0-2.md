---
id: 9810
title: 我写在程序员11期上的文章
date: 2005-11-07T19:39:51+00:00
author: omale
layout: post
guid: http://hezongjian.com/blog/?p=9810
permalink: '/2005/11/07/%e6%88%91%e5%86%99%e5%9c%a8%e7%a8%8b%e5%ba%8f%e5%91%9811%e6%9c%9f%e4%b8%8a%e7%9a%84%e6%96%87%e7%ab%a0-2/'
category:   嵌入式  
tags:   C++  , 同济  , 嵌入式  , 程序员  , 软件
---
《程序员》第11期有个专题，纪念C++诞生20周年，我为这个专题写了一篇文章，叫《C++在嵌入式系统中的运用》，虽然名字起得很大，但是篇幅有限，只能泛泛而谈。空而无物，贴在这里，供大家批评。（一幅图没了，看图的话，买杂志去吧。嘻嘻）

C++嵌入式系统中应用
	  
何宗键
	  
同济大学软件学院嵌入式系统研究中心
	  
转换舞台
	  
C++作为一种编程语言，从其诞生之日至今，已经在软件业的历史上扮演了至关重要的角色。它强大的语言功能和灵活的语言机制是无数程序员为之折腰。而C++中蕴含的OO，GP等编程思想，更是潜移默化的影响了软件的架构方法。从这个层面上讲，C++的影响已经不仅仅是一门编程语言这样简单。然而随着Internet的发展及其带来的B/S架构软件的兴起。新兴的Java/C#/VB.NET等基于虚拟机语言及Ruby/Groovy等动态语言作为后起之秀，凭借其独有的快速开发、简单易用等特性，开始逐渐挑战C++的地位，在企业计算领域占据了越来越重要的地位。抛开企业计算，我们转换舞台，来看一看C++语言在另一块群雄纷争的领域上的身影。
	  
嵌入式系统编程
	  
&ldquo;嵌入式&rdquo;是一个很大的话题，它涉及的领域相当广泛，涵盖了硬件设计与软件开发。大致来说，嵌入式系统有三个特点：嵌入性，专用性和计算性。嵌入性表示系统通常需要嵌入到其他对象系统中，小到计算器、MP3，大到导弹、航天飞机等等。因此必须满足对象系统的环境要求，如物理环境（小型）、电气环境（可靠）、成本（价廉）等要求。专用性表示系统的软硬件要有可裁剪性；满足对象要求的最小软、硬件配置等。计算性表示嵌入式系统必须是能满足对象系统控制要求的计算机系统。正是由于应用系统的环境复杂多样，嵌入式系统的软硬件种类也非常繁多。按照应用需求，处理器可能从4位到128位，内存可能从几K到几百M甚至几G不等。
	  
长久以来，提到嵌入式软件大家首先联想到的可能是慢得可怜的处理器和少得可怜的内存及外存，通常我们称此为资源受限的环境。可以预言，在现在及将来的很长一段时间内，很多嵌入式软件将继续在资源受限的环境下开发。在资源受限的环境下，代码的体积、执行的效率通常都是程序员最关注的因素。正因如此，长期以来，C语言甚至汇编语言在嵌入式领域占据了非常广阔的市场。
	  
C++语言之所以没有从一开始就在嵌入式领域遍地开花，也不是没有原因的。首先，还是由嵌入式应用种类繁多的特点决定，我们永远也不会用ISO C++在四位芯片上编程控制彩灯闪烁（当然这也不是不可以），这种工作只需要几条汇编语句就可以完成，用C++无易于&ldquo;高射炮打蚊子&rdquo;。更重要的一点，ISO C++标准定义了C++的语法规范，但是并没有定义其相对应的开销。现实情况是，在一些编译器的具体实现上，有一些ISO C++的语法特性会导致代码体积膨胀和执行效率的低下。这导致了一些关注嵌入式系统效率与性能的开发人员不愿意使用C++作为嵌入式软件的开发语言。
	  
让C++为嵌入式系统服务
	  
虽然使用C++有可能会对嵌入式软件带来额外的开销，但是这并没有影响C++在嵌入式软件中的推广，在使用C++的过程中，扬长避短，发挥C++在封装、继承等方面的优势，避开可能导致效率与性能问题的语言特性，依然可以开发出优秀的嵌入式软件。
	  
下图列出了C++语言特性及其在OOP中的重要性和实现的成本之间的关系。使用C++在资源受限的环境中编程的时候，需要对这些语言特性进行合理的均衡与取舍。
	  
 
	  
图：C++中的语言特性与性能的折衷
	  
既然ISO C++中有一些语言特性有可能会导致性能和代码体积的问题，如果能对ISO C++进行改造使其适用嵌入式环境，那自然是再好不过的了（虽然这有可能会导致一些铁杆ISO C++支持者的不满）。早在上个世纪90年代，就已经成立了嵌入式C++技术委员会（Embedded C++ Technical Committee），该委员会致力于定义一套适用于嵌入式软件开发的C++语言规范。在1998年，Embedded C++规范正式出炉（我们简称之为EC++），我们可以从EC++的官方网站上查看这份规范，地址是http://www.caravan.net/ec2plus
	  
大致来讲，EC++是标准C++语言的一个子集，它从C++语法中剔除了一些实现复杂和会导致额外负担语法元素。例如：多重继承与虚基类、RTTI、异常处理、模版、命名空间等等。同时，在标准库方面，EC++规范也做了删减，STL和Stream等被剔除了。在EC++规范出炉之后。很多嵌入式厂商都推出了符合EC++规范的编译器，在嵌入式领域有一定的影响。
	  
C++新的应用
	  
近几年来，嵌入式系统领域又有了新的发展。首先，随着手机、PDA等消费性电子产品的飞速增长，嵌入式系统地市场规模在飞速的扩大，这个领域吸引了越来越多的人的眼光。其次，随着Internet的广为流行，越来越多的智能嵌入式应用场景需要互联网的支持，这也从另外一个角度推进了嵌入式系统硬件功能的增强和软件复杂性的提高。在这新一波的浪潮中，C++语言又有了新的用武之地。
	  
在嵌入式SoC设计方面，通常需要对SoC体系结构进行建模以进行体系性能的分析及软硬件联合设计。VHDL等设计语言可以实现这些功能。而在1999年OSCI组织推出的SystemC是建立在C++基础上的开放的系统级设计语言，能够对SoC体系结构进行自然和有效的描述。这样，在嵌入式芯片设计领域，C++也可以施展拳脚。
	  
随着嵌入式软件功能的不断增强，通用计算机上普遍的操作系统也逐渐出现在嵌入式系统中，成为了嵌入式操作系统。嵌入式操作系统种类繁多。在功能、性能、应用领域等都有很大的差异。因此嵌入式领域没有也不可能会像桌面计算机一样有某一款操作系统取得垄断地位。常见的嵌入式操作系统有VxWorks、嵌入式Linux、Windows CE等等。在嵌入式操作系统领域，尤其是高端消费电子产品专用的操作系统领域，C++语言大有可为之处，很多嵌入式操作系统都使用C++搭建，并且对用户以C++的形式提供引用程序编写接口。
	  
在这方面，Symbian OS是一个很好的例子，Symbian OS是由爱立信、诺基亚、摩托罗拉等共同出资开发，其目的是为智能手机提供一个操作系统平台。Symbian OS的API均以C++类的方式提供，应用开发人员可以使用C++开发基于Symbian OS的手机上的应用程序。
	  
软件巨头微软在这方面自然也不甘示弱，其推出的嵌入式操作系统Windows CE以及构建在Windows CE之上的Windows Mobile手机、PDA平台凭借其一贯的易用性在市场上占据了一席之地。而Windows CE配套的开发环境Embedded Visual C++与桌面开发使用的Visual C++在用户界面、使用习惯上都一脉相承，并且Embedded Visual C++集成了桌面开发中常用的MFC、ATL等C++库。使很多桌面应用程序开发人员可以容易的过渡到基于Windows CE的嵌入式开发平台上来。
	  
在国内方面，科泰世纪公司自主研发的和欣（Elastos）嵌入式操作系统不但完全使用C++语言构建，而且还引入了ISO C++中没有的元数据等概念，并允许使用C++语言开发自描述的构件。这样运行时Reflection、组件自描述、二进制继承等优秀的特性再也不是java/C#等语言的&ldquo;专利&rdquo;了。
	  
甚至在一些电子玩具上，也不乏C++的身影。BrickOS是一个运行在乐高（Lego，全球著名的玩具制造商）玩具机器人上的开源嵌入式操作系统，旨在为玩具机器人提供C/C++的编程环境。我们可以从SourceForge网站上查找BrickOS的相关信息。在BrickOS下，就可以使用C++语言编程控制机器人身上的传感器等部件，使机器人完成踢足球、赛跑等复杂的动作（学C++要从娃娃抓起）。
	  
结论
	  
C++语言在诞生之日起就被设计成一种通用（General Purpose）的编程语言，适用于不同的应用场景。经过二十年的发展，C++在服务器端，桌面工作站的程序编写中都有了广泛的应用。随着近年来移动设备与嵌入式系统的迅速崛起，C++在移动与嵌入式领域也有广泛的用武之地。而C++作为系统级编程语言的一些优越的语言特性，在嵌入式设备上可以更好的得以体现。可以预见，随着嵌入式产业的飞速发展及C++语言的不断完善，在嵌入式领域C++必将有更辉煌的前景。
	  
</a>