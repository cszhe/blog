---
id: 9768
title: SSCLIä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼åˆ†æï¼ˆå®Œç»“ç¯‡ï¼‰
date: 2005-02-07T19:33:45+00:00
author: omale
layout: post
guid: http://hezongjian.com/blog/?p=9768
permalink: '/2005/02/07/sscli%e4%b8%8b%e7%9a%84%e5%8f%af%e6%89%a7%e8%a1%8c%e6%96%87%e4%bb%b6%e6%a0%bc%e5%bc%8f%e5%88%86%e6%9e%90%ef%bc%88%e5%ae%8c%e7%bb%93%e7%af%87%ef%bc%89-2/'
category:   æœªåˆ†ç±»  
tags:   C++  , å¾®è½¯  , ç¨‹åºå‘˜
---
CustomAttributeè¡¨æè¿°äº†è¯¥Assemblyä¸­çš„è‡ªå®šä¹‰å±æ€§ï¼ŒåŒ…å«è¦å®ä¾‹åŒ–ä¸€ä¸ªè‡ªå®šä¹‰å±æ€§æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ã€‚è¿™ä¸ªè¡¨æœ‰ä»¥ä¸‹åŸŸæ„æˆï¼ŒParentæ˜¯ä¸ªHasCustomAttributeç±»å‹çš„Coded&nbsp;Tokenï¼ŒTypeæ˜¯ä¸ªCustomAttributeTypeç±»å‹çš„Coded&nbsp;Tokenï¼›Valueæ˜¯ä¸ªæŒ‡å‘#Blobæµçš„ç´¢å¼•ã€‚ä¸€ä¸ªCustomAttributeæœ‰6ä¸ªByteã€‚  
æœ¬ä¾‹ä¸­æœ‰ä¸€ä¸ªCustomAttributeï¼Œ2E&nbsp;00/0B&nbsp;00/39&nbsp;00ã€‚

StandAloneSigè¡¨åªæœ‰ä¸€ä¸ªæŒ‡å‘#Blobæµçš„Signatureã€‚2ä¸ªByteã€‚å¯¹å¤§å¤šæ•°ä½¿ç”¨signatureçš„æƒ…å†µï¼Œå¦‚Field.Signature,&nbsp;Method.Signatureç­‰ç­‰Signatureæ˜¯æŒ‡å‘ä¿å­˜åœ¨Blobæµçš„ä¸€ä¸ªsignatureæ•°æ®å—ã€‚è€Œå¯¹äºä¸€äº›ç‰¹æ®Šæƒ…å†µï¼ŒBlobä¸­ä¿å­˜çš„Signatureæ•°æ®å¯èƒ½ä¸è¢«ä»»æ„ä¸€ä¸ªç»“æ„å…ƒç´ æ‰€å¼•ç”¨ï¼Œä¾‹å¦‚ILæŒ‡ä»¤é›†ä¸­calliæŒ‡ä»¤ï¼ˆé—´æ¥å‡½æ•°è°ƒç”¨æŒ‡ä»¤ï¼Œä½¿ç”¨å‡½æ•°æŒ‡é’ˆè€ŒéæŒ‡å‘æ–¹æ³•çš„Tokenè°ƒç”¨ï¼Œå¾€å¾€ç”¨äºè°ƒç”¨Nativeæ–¹æ³•)éœ€è¦ä¸€ä¸ªSignatureæè¿°å…¶è°ƒç”¨çš„å‡½æ•°æŒ‡é’ˆçš„ç±»å‹ã€‚æ­¤æ—¶å°±éœ€è¦ä¸€ä¸ªStandAloneSigè¡¨é¡¹ï¼ŒæŒ‡å‘è¿™ä¸ªå­¤å„¿signatureã€‚  
æœ¬ä¾‹ä¸­æœ‰ä¸¤ä¸ªStandAloneSigï¼Œå€¼ä¸ºï¼š2A&nbsp;00&nbsp;34&nbsp;00ã€‚

PropertyMapè¡¨æ˜¯ä¸€ä¸ªæ˜ å°„è¡¨ï¼Œè´Ÿè´£æŠŠPropertyDefä¸­å®šä¹‰çš„å±æ€§æ˜ å°„åˆ°å…¶å½’å±çš„TypeDefè¡¨å®šä¹‰çš„ç±»å‹ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å°†å±æ€§çš„å½’å±ä¿¡æ¯ä»ç±»å‹å’Œå±æ€§çš„å®šä¹‰ä¸­å®Œå…¨æŠ½è±¡å‡ºæ¥ã€‚å®ƒæœ‰å¦‚ä¸‹å­—æ®µï¼š2ä¸ªByteçš„æŒ‡å‘TypeDefç´¢å¼•çš„Parentï¼›2ä¸ªByteçš„æŒ‡å‘Propertyè¡¨çš„&nbsp;PropertyListï¼›å› æ­¤ä¸€ä¸ªPropertyMapæœ‰4ä¸ªByteã€‚  
æœ¬ä¾‹ä¸­æœ‰ä¸€ä¸ªPropertyMapï¼Œå€¼ä¸ºï¼š02&nbsp;00&nbsp;01&nbsp;00ã€‚Parentçš„å€¼æ˜¯0x0002ï¼ŒæŒ‡å‘çš„Echoç±»çš„å®šä¹‰ï¼›PropertyListçš„å€¼æ˜¯0x0001ï¼ŒæŒ‡å‘çš„æ˜¯EchoStringå±æ€§çš„å®šä¹‰ï¼Œåˆå¹¶èµ·æ¥ï¼Œæ„æ€æ˜¯è¯´åœ¨Echoç±»ä¸­å®šä¸€ä¸ªäº†ä¸€ä¸ªPropertyï¼Œåä¸ºEchoStringã€‚

Propertyè¡¨æè¿°äº†è¯¥Assemblyä¸­çš„å±æ€§å®šä¹‰ã€‚è¯¥è¡¨æœ‰å¦‚ä¸‹å­—æ®µï¼š2ä¸ªByteçš„Flagsï¼›æŒ‡å‘#Stringsæµçš„Nameç´¢å¼•ï¼›æŒ‡å‘#Blobæµçš„Typeç´¢å¼•ã€‚Flagsçš„å®šä¹‰ä¹Ÿåœ¨Corhdr.hä¸­ï¼Œåä¸ºCorPropertyAttrã€‚æ¯ä¸ªPropertyå ç”¨6ä¸ªByteã€‚  
æœ¬ä¾‹ä¸­æœ‰ä¸€ä¸ªPropertyï¼Œ00&nbsp;00&nbsp;68&nbsp;00&nbsp;1A&nbsp;00ï¼ŒFlagsä¸º0x0000ï¼ŒNameå€¼ä¸º0x0068ï¼Œæ˜¯â€œEchoStringâ€ï¼›Typeå€¼ä¸º0x001Aï¼Œå€¼ä¸º06ã€‚

MethodSemanticè¡¨ç”¨äºå°†å±æ€§æˆ–äº‹ä»¶æ˜ å°„åˆ°å…¶å®ç°ä»£ç æ‰€åœ¨çš„æ–¹æ³•ä¸Šã€‚ä¸€ä¸ªMethodSemanticåŒ…å«å¦‚ä¸‹Fieldï¼š2ä¸ªByteçš„Semanticï¼Œ2ä¸ªByteçš„æŒ‡å‘Methodè¡¨çš„ç´¢å¼•ï¼›2ä¸ªByteçš„Associationæ˜¯HasSemanticç±»å‹çš„Coded&nbsp;Tokenã€‚è¿™æ ·ä¸€ä¸ªè¡¨å°±æœ‰6ä¸ªByteã€‚Semanticçš„å€¼å®šä¹‰åœ¨Corhdr.hä¸­ï¼Œå¦‚ä¸‹ï¼š

//&nbsp;MethodSemantic&nbsp;attr&nbsp;bits,&nbsp;used&nbsp;by&nbsp;DefineProperty,&nbsp;DefineEvent.  
typedef&nbsp;enum&nbsp;CorMethodSemanticsAttr  
{  
&nbsp;&nbsp;&nbsp;&nbsp;msSetter&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;0x0001,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Setter&nbsp;for&nbsp;property&nbsp;&nbsp;  
&nbsp;&nbsp;&nbsp;&nbsp;msGetter&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;0x0002,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Getter&nbsp;for&nbsp;property&nbsp;&nbsp;  
&nbsp;&nbsp;&nbsp;&nbsp;msOther&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;0x0004,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;other&nbsp;method&nbsp;for&nbsp;property&nbsp;or&nbsp;event&nbsp;&nbsp;&nbsp;  
&nbsp;&nbsp;&nbsp;&nbsp;msAddOn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;0x0008,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;AddOn&nbsp;method&nbsp;for&nbsp;event&nbsp;&nbsp;&nbsp;  
&nbsp;&nbsp;&nbsp;&nbsp;msRemoveOn&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;0x0010,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;RemoveOn&nbsp;method&nbsp;for&nbsp;event&nbsp;&nbsp;&nbsp;&nbsp;  
&nbsp;&nbsp;&nbsp;&nbsp;msFire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;0x0020,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Fire&nbsp;method&nbsp;for&nbsp;event&nbsp;&nbsp;&nbsp;&nbsp;  
}&nbsp;CorMethodSemanticsAttr;

æœ¬ä¾‹ä¸­ä¸€å…±æœ‰ä¸¤ä¸ªMethodSemanticï¼Œåˆ†åˆ«æ˜¯ï¼š02&nbsp;00/01&nbsp;00/03&nbsp;00|01&nbsp;00/02&nbsp;00/03&nbsp;00ã€‚åˆ†æç¬¬ä¸€ä¸ªï¼ŒSemanticçš„å€¼ä¸º0x0002ï¼Œæ„æ€æ˜¯å±æ€§çš„Getterï¼ŒMethodçš„å€¼æ˜¯0x0001ï¼ŒæŒ‡å‘Methodè¡¨çš„ç¬¬ä¸€é¡¹ï¼Œæ˜¯â€œget_EchoStringâ€ï¼›Associationçš„å€¼æ˜¯0x0003ï¼Œè§£ç åæ˜¯ï¼š0x17000001ï¼ŒæŒ‡å‘Propertyè¡¨çš„ç¬¬1é¡¹ã€‚

Assemblyæ˜¯æ¯ä¸ªAssemblyå¿…æœ‰çš„è¡¨ï¼Œæè¿°äº†æœ¬Assemblyçš„ä¸€äº›ä¿¡æ¯ã€‚å®ƒæœ‰å¦‚ä¸‹çš„æè¿°é¡¹ï¼š4ä¸ªByteçš„HashAlgIDï¼Œè¯´æ˜äº†æ­¤Assemblyä¸­æ‰€ç”¨çš„Hashç®—æ³•ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š  
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;enum&nbsp;AssemblyHashAlgorithm  
&nbsp;&nbsp;&nbsp;&nbsp;{  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;None&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0,  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MD5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0x8003,  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHA1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0x8004  
&nbsp;&nbsp;&nbsp;&nbsp;}  
ç„¶åæ˜¯ç‰ˆæœ¬ä¿¡æ¯ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨.NETä¸­ï¼Œç‰ˆæœ¬æœ‰å››ä¸ªéƒ¨åˆ†æ„æˆï¼ŒMajorVersion,MinorVersion,BuildNumber,RevisionNumberã€‚è¿™éƒ¨åˆ†ä¿¡æ¯å°±å‚¨å­˜åœ¨è¿™é‡Œï¼Œæ¯ä¸ªéƒ¨åˆ†å ä¸¤ä¸ªByteã€‚æ¥ä¸‹æ¥æ˜¯4ä¸ªByteçš„Flagsã€‚2ä¸ªByteçš„æŒ‡å‘#Blobçš„PublicKeyï¼Œç„¶åæ˜¯ä¸¤ä¸ªæŒ‡å‘#Stringçš„ç´¢å¼•ï¼Œåˆ†åˆ«æ˜¯Nameå’ŒLocaleã€‚é‚£ä¹ˆï¼Œä¸€ä¸ªAssemblyè¡¨é¡¹å 22ä¸ªå­—èŠ‚ã€‚  
æœ¬ä¾‹ä¸­çš„Assemblyçš„å€¼ä¸ºï¼š04&nbsp;80&nbsp;00&nbsp;00/00&nbsp;00/00&nbsp;00/00&nbsp;00/00&nbsp;00/00&nbsp;00&nbsp;00&nbsp;00/00&nbsp;00/9F&nbsp;00/00&nbsp;00ã€‚æˆ‘ä»¬åˆ†æä¸€ä¸‹ï¼Œæœ¬ä¾‹ä¸­Assemblyçš„Hashç®—æ³•ä¸º0x8004ï¼ˆSHA1ï¼‰ã€‚ç‰ˆæœ¬ä¿¡æ¯ä¸ºï¼š0.0.0.0ã€‚Flagsä¸º0x000000ï¼›Public&nbsp;Keyä¸º0x00ï¼›Nameæ˜¯0x009Fâ€œhelloâ€ï¼›Localeä¸º0x0000ã€‚

AssemblyRefè¡¨æè¿°äº†æœ¬Assemblyå¼•ç”¨çš„å…¶ä»–Assemblyã€‚AssemblyRefçš„ç»„æˆåŸºæœ¬ä¸Assemblyå·®ä¸å¤šï¼š4ä¸ªä¸¤Byteçš„ç‰ˆæœ¬å·ï¼Œç„¶åæ˜¯4ä¸ªByteçš„Flagsï¼ŒæŒ‡å‘#Blobçš„PublicKeyOrTokenï¼›æŒ‡å‘#Stringsçš„Nameå’ŒLocaleã€‚å’ŒæŒ‡å‘#Blobçš„HashValueï¼Œä¸€ä¸ªAssemblyRefè¡¨é¡¹å 20ä¸ªByteã€‚  
æœ¬ä¾‹æœ‰ä¸€ä¸ªAssemblyRefè¡¨ï¼š01&nbsp;00/00&nbsp;00/E4&nbsp;0C/00&nbsp;00/00&nbsp;00&nbsp;00&nbsp;00/01&nbsp;00/14&nbsp;00/00&nbsp;00/00&nbsp;00ã€‚è¡¨ç¤ºæœ¬Assemblyå¼•ç”¨äº†ä¸€ä¸ªç‰ˆæœ¬å·ä¸º1.0.3300.1ï¼ŒFlagsä¸º0x00000000ï¼Œåå­—ä¸ºâ€œmscorlibâ€çš„ç¨‹åºé›†ã€‚

æ€»ç»“ï¼š  
è‡³æ­¤ï¼Œè¿™ä¸ªç®€å•çš„Hello&nbsp;Worldç¨‹åºçš„å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼åˆ†æå°±å‘Šä¸€æ®µè½äº†ã€‚æˆ‘ä»¬ä»åˆ†æä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸ä¼ ç»Ÿçš„C/C++ç¨‹åºä¸åŒï¼Œ.NETä¸‹çš„ç¨‹åºç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘ä¹‹åçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ä¸ä»…ä»…åŒ…å«äº†ç¨‹åºçš„å¯æ‰§è¡Œä»£ç ï¼Œè¿˜åŒ…å«äº†å¤§é‡çš„å¯¹è¯¥æ®µä»£ç çš„æè¿°ä¿¡æ¯ã€‚è¿™æ ·ï¼Œå°±ä½¿ç¨‹åºåœ¨è¿è¡Œçš„æ—¶å€™å¾—åˆ°ä»£ç çš„æè¿°ä¿¡æ¯æˆä¸ºå¯èƒ½ï¼Œè¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œè‡ªæè¿°â€ã€‚æœ‰äº†è‡ªæè¿°çš„ç‰¹æ€§ï¼Œä½¿.netä¸‹çš„ç¨‹åºéå¸¸æœ‰åˆ©äºé€šè¿‡ç½‘ç»œè¿è¡Œï¼Œä¸ºå®ç°RPCç­‰æä¾›äº†éå¸¸åšå®çš„åº•å±‚æ”¯æŒã€‚è‡ªæè¿°çš„ä¼˜ç‚¹æ˜¯ä¸ç”¨å¤šè¯´äº†ï¼Œç¼ºç‚¹ä¹ˆï¼Œåæ±‡ç¼–å®¹æ˜“äº†ä¸å°‘ï¼ŒçŸ¥è¯†äº§æƒå“ª&nbsp;ğŸ˜€&nbsp;â€¦â€¦  
ä½†æ˜¯ï¼Œåœ¨æœ¬æ–‡ä¸­ä¸€å…±åªæœ‰14ç§è¡¨ï¼Œè¿˜æœ‰å¾ˆå¤šSSCLIä¸­çš„è¡¨æ²¡æœ‰æ¶‰åŠåˆ°ï¼Œä¾‹å¦‚äº‹ä»¶ã€‚æ­¤å¤–ï¼ŒåŸæ•°æ®åªæ˜¯.NETä»£ç ä¿¡æ¯çš„é™æ€æè¿°ï¼Œåœ¨è¿è¡Œæ—¶ï¼Œ.NETé€šè¿‡Class&nbsp;LoaderæŠŠç¨‹åºé›†åŠ è½½åˆ°å†…å­˜ï¼Œæœ‰å¦å¤–ä¸€å¥—åŠ¨æ€çš„æè¿°ä»£ç çš„æ–¹å¼ï¼ˆSSCLIä¸­çš„EEClasså’ŒMethodTableç­‰ï¼‰ï¼Œå¹¶ä¸”æä¾›äº†System.Reflectionå‘½åç©ºé—´ä¸ºç¨‹åºå‘˜æä¾›ç¼–ç¨‹æ¥å£ã€‚å¦‚æœæœ‰æ—¶é—´ï¼Œæˆ‘ä¼šæ¥ç€åˆ†æClass&nbsp;Loaderçš„ä»£ç ã€‚  
é™¤äº†System.Reflectionä¹‹å¤–ï¼Œå¾®è½¯è¿˜æä¾›äº†ä¸€å¥—ç§°ä¹‹ä¸ºâ€œManifest&nbsp;APIâ€çš„éæ‰˜ç®¡ç¼–ç¨‹æ¥å£ï¼Œç”¨æ¥è®¿é—®ï¼Œåˆ†æå’Œç”Ÿæˆå…ƒæ•°æ®ï¼Œè¿™äº›APIåŸºæœ¬ä¸Šæ˜¯åŸºäºCOMæ¥å£çš„ï¼ŒCLRè™šæ‹Ÿæœºè®¿é—®MetaDataåŸºæœ¬ä¸Šä¹Ÿæ˜¯ä½¿ç”¨è¿™äº›æ¥å£ã€‚ä½†å¾®è½¯å£°ç§°è¿™æ˜¯ç»™å¼€å‘å·¥å…·ï¼ˆä¾‹å¦‚å…¶ä»–è¯­è¨€çš„ç¼–è¯‘å™¨ï¼‰çš„ç¨‹åºå‘˜ç”¨çš„ã€‚SSCLIä¸­cli\src\mdç›®å½•ä¸‹çš„ä»£ç åŸºæœ¬ä¸Šå°±æ˜¯Manifest&nbsp;APIçš„å®ç°ä»£ç ã€‚  
åœ¨æ–°çš„Visual&nbsp;Studio&nbsp;â€œWhidbeyâ€å‘è¡Œä¹‹åï¼Œå¾®è½¯ä¼šå‘å¸ƒä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„SSCLIã€‚ä¸çŸ¥é“å˜åŒ–ä¼šæœ‰å¤šå¤§å‘¢ï¼Ÿ